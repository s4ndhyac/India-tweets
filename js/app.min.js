!function(){function L(){K.history({channel:J,count:100,callback:function(a){K.each(a[0],Q),M()},error:function(a){console.log(a),a&&M()}})}function M(){K.subscribe({channel:J,callback:Q})}function N(a,b){if(a.geo){var c={};if(c.lat=a.geo.coordinates[0],c.lon=a.geo.coordinates[1],0!==c.lat||0!==c.lon){var d=a.place.full_name;c.city=d,c.state=d.substring(d.lastIndexOf(",")+1).trim(),c.name=a.user.name,c.screenname=a.user.screen_name,c.avatar=a.user.profile_image_url,c.tweet=a.text,c.id_str=a.id_str;var e=new Date(parseInt(a.timestamp_ms)),f=e.toDateString().substr(4),g=e.getHours()>12?e.getHours()-12+":"+e.getMinutes()+" PM":e.getHours()+":"+e.getMinutes()+" AM;";c.timestamp=g+" - "+f,console.log(c.tweet),b(c)}}}function O(a){return a.replace(/((https?|s?ftp|ssh)\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!])/g,function(a){return'<a href="'+a+'" >'+a+"</a>"})}function P(a,b){N(a,function(a){if(document.querySelector(".emotion").style.backgroundImage="url(images/"+b.icon+")",document.querySelector(".button").href="https://twitter.com/"+a.screenname,document.querySelector(".header").style.backgroundImage="url("+a.avatar+")",document.querySelector(".name").textContent=a.name,document.querySelector(".screenname").textContent="@"+a.screenname,document.querySelector(".text").innerHTML=twemoji.parse(O(a.tweet)),document.querySelector(".timestamp").textContent=a.timestamp,document.querySelector(".reply").href="https://twitter.com/intent/tweet?in_reply_to="+a.id_str,document.querySelector(".retweet").href="https://twitter.com/intent/retweet?tweet_id="+a.id_str,document.querySelector(".favorite").href="https://twitter.com/intent/favorite?tweet_id="+a.id_str,document.querySelector(".tweet").style.opacity=.9,document.querySelector("."+a.state)){c[a.state]=c[a.state]||{positive:0,negative:0},c[a.state][b.type]=(c[a.state][b.type]||0)+1;var g=document.querySelector("."+a.state);g.style.fill=c[a.state].positive>c[a.state].negative?d:c[a.state].positive<c[a.state].negative?e:f,g.setAttribute("data-positive",c[a.state].positive),g.setAttribute("data-negative",c[a.state].negative)}var h=z([a.lon,a.lat]);null!==h&&I.enter().append("svg:image").attr("xlink:href","images/"+b.icon).attr("width","26").attr("height","26").attr("transform",function(a){return"translate("+h+")"})})}function Q(a){a&&a.place&&a.lang&&"IN"===a.place.country_code&&(n.some(function(b){return a.text.toLowerCase().indexOf(b)!==-1})?P(a,g):o.some(function(b){return a.text.toLowerCase().indexOf(b)!==-1})?P(a,h):p.some(function(b){return a.text.toLowerCase().indexOf(b)!==-1})?P(a,i):q.some(function(b){return a.text.toLowerCase().indexOf(b)!==-1})?P(a,j):r.some(function(b){return a.text.toLowerCase().indexOf(b)!==-1})?P(a,k):s.some(function(b){return a.text.toLowerCase().indexOf(b)!==-1})?P(a,l):t.some(function(b){return a.text.toLowerCase().indexOf(b)!==-1})&&P(a,m))}var a=!0,b=document.getElementById("toggle");b.addEventListener("click",function(c){a?(K.unsubscribe({channel:J}),b.value="Stream",a=!1):(L(),b.value="Stop",a=!0)},!1);var c={},d="#FF8586",e="#63A69F",f="#DECEB3",g={type:"positive",icon:"grinning-face.png"},h={type:"positive",icon:"smiling-face.png"},i={type:"positive",icon:"heart-eyed-happy-face.png"},j={type:"negative",icon:"pensive-face.png"},k={type:"negative",icon:"crying-face.png"},l={type:"negative",icon:"angry-face.png"},m={type:"negative",icon:"sick-face.png"},n=["excellent","amazing","beautiful","nice","marvelous","magnificent","fabulous","astonishing","fantastic","peaceful","fortunate","brilliant","glorious","cheerful","gracious","grateful","splendid","superb","honorable","thankful","inspirational","ecstatic","victorious","virtuous","proud","wonderful","lovely","delightful"],o=["happy","lucky","awesome","excited","fun","amusing","amused","pleasant","pleasing","glad","enjoy","jolly","delightful","joyful","joyous",":-)",":)",":-D",":D","=)","â˜º"],p=["love","adore","blissful","heartfelt","loving","lovable","sweetheart","darling","kawaii","married","engaged"],q=["unhappy","bad","sorry","annoyed","dislike","anxious","ashamed","cranky","crap","crappy","envy","awful","bored","boring","bothersome","bummed","burned","chaotic","defeated","devastated","stressed","disconnected","discouraged","dishonest","doomed","dreadful","embarrassed","evicted","freaked out","frustrated","stupid","guilty","hopeless","horrible","horrified","humiliated","ignorant","inhumane","cruel","insane","insecure","nervous","offended","oppressed","overwhelmed","pathetic","powerless","poor","resentful","robbed","screwed"],r=["sad","alone","anxious","depressed","disappointed","disappointing","sigh","sobbing","crying","cried","dumped","heartbroken","helpless","hurt","miserable","misunderstood","suicidal",":-(",":(","=(",";("],s=["hate","damn","angry","betrayed","bitched","disgust","disturbed","furious","harassed","hateful","hostile","insulted","irritable","jealous"," rage ","pissed"],t=["sick"," ill ","under weather","throw up","threw up","throwing up","puke","puking","pain","hangover","intoxicated"],u=900,v=540,w=900,x=[u/2,v/2],y=d3.json("json/india-states.json",function(a){var b=d3.geo.centroid(a);return b}),z=d3.geo.mercator().scale(w).center(y).translate(x),A=d3.geo.path().projection(z),B=d3.json("json/india-states.json",function(a){return a}),C=A.bounds(B),D=w*u/(C[1][0]-C[0][0]),E=w*v/(C[1][1]-C[0][1]),w=D<E?D:E,x=[u-(C[0][0]+C[1][0])/2,v-(C[0][1]+C[1][1])/2];z=d3.geo.mercator().center(y).scale(w).translate(x),A=A.projection(z);var F=d3.scale.linear().domain([0,15]).range(["#5b5858","#4f4d4d","#454444","#323131"]),G=d3.select("#map").append("svg").attr("width",u).attr("height",v),H=G.append("g");d3.json("json/india-states.json",function(a,b){H.selectAll("path").data(topojson.feature(b,b.objects.indiaStates).features).enter().append("path").attr("class",function(a){return"states "+a.properties.NAME_1}).attr("d",A).attr("fill",function(a,b){return F(b)})});var I=G.selectAll("image").data([0]),J="pubnub-twitter",K=PUBNUB.init({subscribe_key:"sub-c-78806dd4-42a6-11e4-aed8-02ee2ddab7fe",ssl:!0});L()}();
